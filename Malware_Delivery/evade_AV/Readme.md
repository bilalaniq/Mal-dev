# Antivirus (AV)/endpoint detection response (EDR) evasion tricks


An effective way to evade
AV is to employ encryption. This might involve encrypting a payload (i.e., the actual malicious
code) and decrypting it only when it’s about to be executed. The following is an oversimplified
example demonstrating this concept:



```cpp
#include <windows.h>
#include <stdio.h>
// Function to perform simple XOR encryption/decryption
void xor_encrypt_decrypt(char* input, char key) {
  char* iterator = input;
  while(*iterator) {
      *iterator ^= key;
      iterator++;
  }
}
int main() {
  char payload[] = "<MALICIOUS_PAYLOAD>";
  printf("original payload: %s\n", payload);
  // Encrypt the payload
  xor_encrypt_decrypt(payload, 'K');
  printf("encrypted payload: %s\n", payload);
  // At this point, the payload might not be recognized by AV
  // When we're ready to execute it, we decrypt it
  xor_encrypt_decrypt(payload, 'K');
  printf("decrypted payload: %s\n", payload);
  // Now we can execute our payload...
  hack();
  return 0;
}
```